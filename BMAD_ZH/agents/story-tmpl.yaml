# <!-- 由 BMAD™ Core 驱动 -->
template:
  id: story-template-v2
  name: 故事文档
  version: 2.0
  output:
    format: markdown
    filename: docs/stories/{{epic_num}}.{{story_num}}.{{story_title_short}}.md
    title: "故事 {{epic_num}}.{{story_num}}: {{story_title_short}}"

workflow:
  mode: interactive
  elicitation: advanced-elicitation

agent_config:
  editable_sections:
    - Status
    - Story
    - Acceptance Criteria
    - Tasks / Subtasks
    - Dev Notes
    - Testing
    - Change Log

sections:
  - id: status
    title: 状态
    type: choice
    choices: [草稿, 已批准, 进行中, 审查中, 完成]
    instruction: 选择故事的当前状态
    owner: scrum-master
    editors: [scrum-master, dev-agent]

  - id: story
    title: 故事
    type: template-text
    template: |
      **作为一个** {{role}},
      **我想要** {{action}},
      **以便于** {{benefit}}
    instruction: 使用包含角色、行动和收益的标准格式定义用户故事
    elicit: true
    owner: scrum-master
    editors: [scrum-master]

  - id: acceptance-criteria
    title: 验收标准
    type: numbered-list
    instruction: 从史诗 (epic) 文件中复制验收标准的编号列表
    elicit: true
    owner: scrum-master
    editors: [scrum-master]

  - id: tasks-subtasks
    title: 任务 / 子任务
    type: bullet-list
    instruction: |
      将故事分解为实现所需的具体任务和子任务。
      在相关处引用适用的验收标准编号。
    template: |
      - [ ] 任务 1 (AC: # 如果适用)
        - [ ] 子任务 1.1...
      - [ ] 任务 2 (AC: # 如果适用)
        - [ ] 子任务 2.1...
      - [ ] 任务 3 (AC: # 如果适用)
        - [ ] 子任务 3.1...
    elicit: true
    owner: scrum-master
    editors: [scrum-master, dev-agent]

  - id: dev-notes
    title: 开发说明
    instruction: |
      仅填充从 docs 文件夹中的实际工件中提取的、与此故事相关的信息：
      - 不要杜撰信息
      - 如果已知，添加与此故事相关的源文件树信息
      - 如果上一个故事中有与此故事相关的重要说明，请在此处包含它们
      - 在此部分提供足够的信息，以便开发 agent 永远不需要阅读架构文档，这些说明以及任务和子任务必须为开发 agent 提供完成故事所需的完整上下文，以最小的开销理解信息，满足所有 AC 并完成所有任务+子任务
    elicit: true
    owner: scrum-master
    editors: [scrum-master]
    sections:
      - id: testing-standards
        title: 测试
        instruction: |
          列出开发人员需要遵守的来自架构的相关测试标准：
          - 测试文件位置
          - 测试标准
          - 要使用的测试框架和模式
          - 此故事的任何特定测试要求
        elicit: true
        owner: scrum-master
        editors: [scrum-master]

  - id: change-log
    title: 变更日志
    type: table
    columns: [日期, 版本, 描述, 作者]
    instruction: 跟踪对此故事文档所做的更改
    owner: scrum-master
    editors: [scrum-master, dev-agent, qa-agent]

  - id: dev-agent-record
    title: 开发 Agent 记录
    instruction: 此部分由开发 agent 在实施期间填充
    owner: dev-agent
    editors: [dev-agent]
    sections:
      - id: agent-model
        title: 使用的 Agent 模型
        template: "{{agent_model_name_version}}"
        instruction: 记录用于开发的特定 AI agent 模型和版本
        owner: dev-agent
        editors: [dev-agent]

      - id: debug-log-references
        title: 调试日志参考
        instruction: 引用开发期间生成的任何调试日志或跟踪
        owner: dev-agent
        editors: [dev-agent]

      - id: completion-notes
        title: 完成说明列表
        instruction: 关于任务完成情况和遇到的任何问题的说明
        owner: dev-agent
        editors: [dev-agent]

      - id: file-list
        title: 文件列表
        instruction: 列出在故事实施期间创建、修改或影响的所有文件
        owner: dev-agent
        editors: [dev-agent]

  - id: qa-results
    title: QA 结果
    instruction: QA Agent 对已完成故事实施进行 QA 审查的结果
    owner: qa-agent
    editors: [qa-agent]
