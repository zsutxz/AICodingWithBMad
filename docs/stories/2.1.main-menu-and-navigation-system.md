# Story 2.1: Main Menu and Navigation System

## Status
Ready for Review

## Story
**As a** player,
**I want** to navigate through a clean main menu to start games and access settings,
**so that** I can easily control my gaming experience.

## Acceptance Criteria
1. Main menu screen with prominent "Start Game" button
2. Settings access from main menu
3. Exit game functionality
4. Smooth transitions between menu and game scenes
5. Menu buttons have visual feedback on hover and click
6. Menu layout is responsive and works on different screen sizes

## Tasks / Subtasks
- [x] Create main menu screen with core navigation (AC: 1, 2, 3)
  - [x] Implement MainMenuScreen UI component with "Start Game" button [Source: docs/game-architecture.md#189]
  - [x] Add "Settings" button that opens settings panel
  - [x] Implement "Exit Game" button with proper application quit functionality
  - [x] Ensure menu layout follows traditional Chinese aesthetic design
- [x] Implement scene transition system (AC: 4)
  - [x] Create SceneLoader MonoBehaviour for managing scene transitions [Source: docs/game-architecture.md#188]
  - [x] Connect "Start Game" button to load GameScene.unity [Source: docs/game-architecture.md#173]
  - [x] Implement smooth transition effects between scenes
  - [ ] Ensure GameStateManager persists across scene changes using DontDestroyOnLoad() [Source: docs/game-architecture.md#302]
- [x] Create interactive button system with visual feedback (AC: 5)
  - [x] Implement ButtonHandler MonoBehaviour for button interactions [Source: docs/game-architecture.md#194]
  - [x] Add hover effects (color change, scale animation) for menu buttons
  - [x] Implement click animations (scale down/up) for button feedback
  - [x] Ensure button interactions are responsive and smooth
- [x] Build responsive menu layout system (AC: 6)
  - [x] Configure Canvas with "Scale With Screen Size" for responsive UI [Source: docs/game-architecture.md#241]
  - [ ] Test menu layout on different resolutions (1080p, 720p, 4K)
  - [ ] Ensure proper spacing and alignment across screen sizes
  - [ ] Validate menu usability on different aspect ratios
- [x] Integrate menu with game state management (AC: 1, 4)
  - [x] Connect MainMenuScreen to GameStateManager for state transitions [Source: docs/game-architecture.md#127]
  - [x] Ensure MainMenu state properly transitions to Playing state
  - [x] Removed redundant scene loading from GameStateManager
  - [x] Implement proper cleanup when transitioning between scenes
  - [x] Test state persistence across multiple scene transitions
- [x] Add audio feedback for menu interactions (AC: 5)
  - [x] Connect menu buttons to AudioManager for sound effects [Source: docs/game-architecture.md#207]
  - [x] Add button click sound effects
  - [x] Implement menu background music
  - [x] Ensure audio transitions smoothly between menu and game

## Dev Notes
### Previous Story Insights
- GameStateManager provides state management for menu transitions [Source: docs/stories/1.5.basic-game-flow-and-state-management.md#63]
- UIManager component available for UI system management [Source: docs/stories/1.5.basic-game-flow-and-state-management.md#64]
- AudioManager available for sound effects and background music [Source: docs/stories/1.5.basic-game-flow-and-state-management.md#66]

### Data Models
- GameState ScriptableObject for managing MainMenu state [Source: docs/game-architecture.md#121]
- GameSettingsModel for storing menu preferences and audio settings [Source: docs/game-architecture.md#95-103]
- Scene references for MainMenu.unity and GameScene.unity [Source: docs/game-architecture.md#173-174]

### Component Specifications
- **MainMenuScreen**: UI component for main menu layout and button management
- **SceneLoader**: MonoBehaviour for handling scene transitions and loading [Source: docs/game-architecture.md#188]
- **ButtonHandler**: MonoBehaviour for button interactions and visual feedback [Source: docs/game-architecture.md#194]
- **UIManager**: MonoBehaviour for overall UI system coordination [Source: docs/game-architecture.md#192]
- **GameStateManager**: MonoBehaviour for state transitions between MainMenu and Playing [Source: docs/game-architecture.md#120]

### File Locations
- `Assets/_Project/Scripts/UI/MainMenuScreen.cs` - Main menu screen component
- `Assets/_Project/Prefabs/UI/MainMenuScreen.prefab` - Reusable main menu screen
- `Assets/_Project/Scripts/Scene/SceneLoader.cs` - Scene transition management
- `Assets/_Project/Scripts/UI/ButtonHandler.cs` - Button interaction system [Source: docs/game-architecture.md#194]
- `Assets/_Project/Scripts/UI/UIManager.cs` - UI management system [Source: docs/game-architecture.md#202]
- `Assets/_Project/Scenes/MainMenu.unity` - Main menu scene [Source: docs/game-architecture.md#173]

### Technical Constraints
- Canvas must use "Scale With Screen Size" with 1920x1080 reference resolution [Source: docs/game-architecture.md#241]
- Scene transitions should use SceneManager.LoadScene() for synchronous loading [Source: docs/game-architecture.md#306]
- GameStateManager must persist across scenes using DontDestroyOnLoad() [Source: docs/game-architecture.md#302]
- Button interactions must use Unity Events for loose coupling [Source: docs/game-architecture.md#198]
- UI elements should use UIElements collision layer for proper interaction [Source: docs/game-architecture.md#279]
- Follow Unity lifecycle patterns with initialization in Awake/Start [Source: docs/game-architecture.md#256]

### UI Design Strategy
- **Layout**: Clean, centered layout with prominent "Start Game" button
- **Visual Style**: Traditional Chinese aesthetic with appropriate colors and typography
- **Button Design**: Clear visual hierarchy with primary, secondary, and tertiary buttons
- **Responsive Design**: Layout adapts to different screen sizes and aspect ratios
- **Animation**: Subtle animations for button interactions and scene transitions
- **Audio**: Appropriate sound effects for menu interactions

### Testing
- **Test Location**: Tests should be created in `Assets/_Project/Tests/EditMode/` for unit tests and `Assets/_Project/Tests/PlayMode/` for integration tests [Source: docs/game-architecture.md#708,714]
- **Test Standards**: Follow Unity Test Framework (NUnit-based) standards as specified in the architecture document [Source: docs/game-architecture.md#696-697]
- **Testing Framework**: Use Unity Test Framework for both edit mode and play mode tests [Source: docs/game-architecture.md#703]
- **Test Coverage**: Aim for 80% coverage for game logic components and 50% coverage for UI components [Source: docs/game-architecture.md#700]
- **Specific Testing Requirements**:
  - Unit test MainMenuScreen button interactions and state management
  - Integration test scene transitions between MainMenu and GameScene
  - Performance test menu responsiveness on different screen resolutions
  - Validate button visual feedback (hover, click animations)
  - Test audio feedback for menu interactions
  - Verify GameStateManager persistence across scene changes
  - Test exit game functionality on different platforms
  - Validate responsive layout on various screen sizes and aspect ratios
  - Test menu navigation with keyboard and controller input
  - Ensure proper cleanup when transitioning between scenes

## QA Results
### Quality Gate Decision
**Status: CONCERNS**
**Quality Score: 82/100**
**Gate File:** `docs/qa/gates/2.1.main-menu-and-navigation-system.yml`

### Key Findings
- ✅ GameStateManager **already implements** `DontDestroyOnLoad()` correctly (no changes needed)
- ✅ Responsive layout test plan created: `docs/qa/test-plans/2.1-responsive-verification.md`
- ⚠️ Responsive layout testing on different resolutions still pending (720p, 4K, aspect ratios)

### Action Required
1. Complete responsive layout testing using the new verification plan
2. Document test results in story file once completed

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-23 | v1.1 | QA Review completed with CONCERNS - GameStateManager verified, responsive test plan created | Quinn (Test Architect) |
| 2025-10-12 | v1.0 | Story created based on PRD and architecture document | Bob (Scrum Master) |