# Story 2.4: Audio System and Sound Effects

## Status
Draft

## Story
**As a** player,
**I want** to hear appropriate sound effects for game actions,
**so that** I can have a more immersive gaming experience.

## Acceptance Criteria
1. Piece placement sound effect plays on valid moves
2. Win condition triggers victory sound
3. Menu interactions have appropriate audio feedback
4. Audio manager handles sound volume and mixing
5. Sound effects are non-intrusive and complement gameplay
6. Audio can be muted or adjusted in settings

## Tasks / Subtasks
- [ ] Implement piece placement audio feedback (AC: 1)
  - [ ] Create PlayPiecePlacementSound method in AudioManager
  - [ ] Connect to PiecePlacement system for triggering on valid moves
  - [ ] Select appropriate stone-on-wood sound effect
  - [ ] Ensure sound plays only for valid placements
  - [ ] Test audio feedback with different move patterns
- [ ] Implement victory audio system (AC: 2)
  - [ ] Create PlayVictorySound method in AudioManager
  - [ ] Connect to WinDetector for automatic triggering when win condition is met
  - [ ] Select appropriate victory/chime sound effect
  - [ ] Ensure sound plays only once per victory
  - [ ] Test victory audio with different win conditions
- [ ] Implement menu interaction audio feedback (AC: 3)
  - [ ] Create PlayUIClick method in AudioManager
  - [ ] Connect to ButtonHandler for UI button interactions
  - [ ] Add hover sound effects for menu buttons
  - [ ] Implement different sounds for main menu, pause menu, and game over screen
  - [ ] Test audio feedback across all menu interactions
- [ ] Configure audio management system (AC: 4)
  - [ ] Set up audio mixer with separate groups for SFX, UI, and Music
  - [ ] Implement volume controls for master, SFX, UI, and music channels
  - [ ] Save audio settings in GameSettingsModel
  - [ ] Load saved audio settings on game start
  - [ ] Test volume adjustments and persistence
- [ ] Optimize audio implementation (AC: 5)
  - [ ] Ensure sound effects are short and non-intrusive
  - [ ] Balance audio levels so sounds complement rather than distract from gameplay
  - [ ] Use appropriate audio compression settings for performance
  - [ ] Test audio on different devices and speakers
  - [ ] Validate audio enhances overall game experience
- [ ] Implement audio settings integration (AC: 6)
  - [ ] Add audio controls to Settings screen
  - [ ] Connect sliders to audio mixer for real-time adjustments
  - [ ] Implement mute toggle for quick muting
  - [ ] Ensure settings apply immediately without requiring restart
  - [ ] Test settings functionality across different game states

## Dev Notes
### Previous Story Insights
- AudioManager component available for audio management [Source: docs/stories/1.5.basic-game-flow-and-state-management.md#66]
- ButtonHandler component implemented for UI interactions [Source: docs/stories/2.1.main-menu-and-navigation-system.md#65]
- WinDetector provides victory detection events [Source: docs/stories/1.4.gomoku-win-detection-logic.md#36-39]
- GameSettingsModel includes settings persistence [Source: docs/stories/1.5.basic-game-flow-and-state-management.md#60]

### Data Models
- GameSettingsModel stores audio preferences including volume levels and mute state [Source: docs/game-architecture.md#95-103]
- GameState ScriptableObject manages current game state for context-appropriate audio [Source: docs/game-architecture.md#121]

### Component Specifications
- **AudioManager**: MonoBehaviour for managing all audio playback and mixer settings [Source: docs/game-architecture.md#96]
- **ButtonHandler**: MonoBehaviour for handling UI button interactions with audio feedback [Source: docs/game-architecture.md#194]
- **WinDetector**: MonoBehaviour for detecting win conditions and triggering victory audio [Source: docs/game-architecture.md#174]
- **PiecePlacement**: MonoBehaviour for handling piece placement logic with audio feedback [Source: docs/game-architecture.md#156]
- **GameStateManager**: MonoBehaviour for state transitions that may affect audio [Source: docs/game-architecture.md#120]

### File Locations
- `Assets/_Project/Scripts/Audio/AudioManager.cs` - Main audio management system [Source: docs/game-architecture.md#106]
- `Assets/_Project/Scripts/UI/ButtonHandler.cs` - Button interaction system with audio integration [Source: docs/game-architecture.md#194]
- `Assets/_Project/Scripts/Win/WinDetector.cs` - Win detection system [Source: docs/game-architecture.md#174]
- `Assets/_Project/Scripts/Piece/PiecePlacement.cs` - Piece placement system [Source: docs/game-architecture.md#156]
- `Assets/_Project/Scripts/GameState/GameStateManager.cs` - State management [Source: docs/game-architecture.md#120]
- `Assets/_Project/Resources/Audio/` - Audio clips directory

### Technical Constraints
- AudioManager must use singleton pattern for global access [Source: docs/game-architecture.md#380]
- Audio settings must be saved and loaded using GameSettingsModel [Source: docs/game-architecture.md#102]
- Sound effects should be under 1 second in duration to avoid intrusion [Source: docs/game-architecture.md#530]
- Use Unity's AudioSource component for playing sounds [Source: docs/game-architecture.md#287]
- Follow Unity lifecycle patterns with initialization in Awake/Start [Source: docs/game-architecture.md#256]
- Audio mixer snapshots should be used for smooth transitions between game states [Source: docs/game-architecture.md#452]

### Audio Design Strategy
- **Piece Placement**: Short, subtle stone-on-wood sound effect that reinforces successful placement
- **Victory**: Clear chime or bell sound that celebrates the win without being overwhelming
- **Menu Interactions**: Distinct click sounds for button presses, subtle hover sounds for navigation
- **Volume Levels**: Balanced mix where UI sounds are slightly louder than game sounds, music at background level
- **Accessibility**: Visual indicators accompany important audio cues for hearing-impaired players

### Testing
- **Test Location**: Tests should be created in `Assets/_Project/Tests/EditMode/` for unit tests and `Assets/_Project/Tests/PlayMode/` for integration tests [Source: docs/game-architecture.md#708,714]
- **Test Standards**: Follow Unity Test Framework (NUnit-based) standards as specified in the architecture document [Source: docs/game-architecture.md#696-697]
- **Testing Framework**: Use Unity Test Framework for both edit mode and play mode tests [Source: docs/game-architecture.md#703]
- **Test Coverage**: Aim for 80% coverage for game logic components and 50% coverage for UI components [Source: docs/game-architecture.md#700]
- **Specific Testing Requirements**:
  - Unit test AudioManager methods for proper sound playback
  - Integration test piece placement audio with actual game board interactions
  - Verify victory sound triggers only once per win
  - Test audio settings persistence across game sessions
  - Validate volume controls adjust mixer levels correctly
  - Test audio feedback for all menu interactions
  - Ensure sounds do not overlap or cause audio glitches
  - Performance test audio memory usage and loading times
  - Verify audio works correctly in all game states (main menu, playing, paused, game over)
  - Test mute functionality across all audio categories

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-24 | v1.0 | Story created based on PRD and architecture document | Bob (Scrum Master) |