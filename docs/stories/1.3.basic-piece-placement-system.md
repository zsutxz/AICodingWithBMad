# Story 1.3: Basic Piece Placement System

## Status
Approved

## Story
**As a** player,
**I want** to click on board intersections to place black and white pieces alternately,
**so that** I can play the basic game of Gomoku.

## Acceptance Criteria
1. Click detection on board intersections works accurately
2. Black and white pieces placed alternately on valid intersections
3. Pieces cannot be placed on occupied intersections
4. Visual feedback shows valid placement locations
5. Turn indicator displays which player's turn it is
6. Piece placement is immediate with no noticeable lag

## Tasks / Subtasks
- [ ] Implement accurate click detection on board intersections (AC: 1)
  - [ ] Configure IntersectionDetector MonoBehaviour for precise intersection detection [Source: docs/game-architecture.md#140]
  - [ ] Use Unity's Input System with "PlacePiece" action for mouse/touch input [Source: docs/game-architecture.md#296]
  - [ ] Validate click coordinates against 15x15 grid boundaries
  - [ ] Ensure detection works for both mouse and touch input
- [ ] Create piece placement system with turn management (AC: 2, 3)
  - [ ] Implement PiecePlacement MonoBehaviour to handle piece placement logic [Source: docs/game-architecture.md#156]
  - [ ] Create TurnManager MonoBehaviour to track current player (black/white) [Source: docs/game-architecture.md#158]
  - [ ] Validate placement on unoccupied intersections only
  - [ ] Implement alternating turn logic between players
- [ ] Create game piece prefabs and visual system (AC: 2, 4)
  - [ ] Create Piece MonoBehaviour for game piece behavior [Source: docs/game-architecture.md#157]
  - [ ] Create black and white piece prefabs with traditional Chinese aesthetic [Source: docs/game-architecture.md#167]
  - [ ] Implement visual feedback for valid placement locations
  - [ ] Add highlight effects for current valid intersections
- [ ] Implement turn indicator UI (*AC: 5)
  - [ ] Create TurnIndicator UI component to display current player [Source: docs/game-architecture.md#378]
  - [ ] Update turn indicator when player turn changes
  - [ ] Ensure clear visual distinction between black and white turns
- [ ] Optimize performance for immediate piece placement (AC: 6)
  - [ ] Implement object pooling for game pieces to minimize instantiation overhead [Source: docs/game-architecture.md#289]
  - [ ] Use Rigidbody2D with Kinematic body type for game pieces [Source: docs/game-architecture.md#285]
  - [ ] Ensure piece placement happens in LateUpdate() for responsive gameplay [Source: docs/game-architecture.md#161]
  - [ ] Test performance on target hardware to ensure no lag

## Dev Notes
### Previous Story Insights
- Game board system provides 15x15 grid with intersection detection [Source: docs/game-architecture.md#135-149]
- Board uses traditional Chinese aesthetic with dark wood tones [Source: docs/stories/1.2.game-board-creation-and-display.md#26-27]
- Project structure follows Unity best practices with organized folders [Source: docs/stories/1.1.project-setup-and-basic-scene-structure.md#24-29]

### Data Models
- GameBoardModel stores board state in 15x15 array (0=empty, 1=black, 2=white) [Source: docs/game-architecture.md#81]
- currentPlayer tracks which player's turn it is (1=black, 2=white) [Source: docs/game-architecture.md#82]
- moveHistory stores sequence of moves for undo functionality [Source: docs/game-architecture.md#83]

### Component Specifications
- **PiecePlacement**: MonoBehaviour for piece placement logic, handles turn management and move validation [Source: docs/game-architecture.md#156]
- **Piece**: MonoBehaviour for game piece behavior, manages visual representation and interactions [Source: docs/game-architecture.md#157]
- **TurnManager**: MonoBehaviour for tracking current player and turn transitions [Source: docs/game-architecture.md#158]
- **IntersectionDetector**: MonoBehaviour for detecting clicks on board intersections [Source: docs/game-architecture.md#140]

### File Locations
- `Assets/_Project/Scripts/Piece/PiecePlacement.cs` - Main piece placement logic [Source: docs/game-architecture.md#166]
- `Assets/_Project/Prefabs/Piece/Piece.prefab` - Reusable game piece component [Source: docs/game-architecture.md#167]
- `Assets/_Project/Scripts/Piece/TurnManager.cs` - Turn management system
- `Assets/_Project/Scripts/GameBoard/IntersectionDetector.cs` - Intersection click detection [Source: docs/game-architecture.md#140]
- `Assets/_Project/Scripts/UI/TurnIndicator.cs` - UI component for turn display [Source: docs/game-architecture.md#378]

### Technical Constraints
- Use Unity Input System for cross-platform input handling [Source: docs/game-architecture.md#293]
- Implement object pooling for game pieces to minimize instantiation overhead [Source: docs/game-architecture.md#289]
- Use Rigidbody2D with Kinematic body type for game pieces [Source: docs/game-architecture.md#285]
- Follow Unity lifecycle patterns: initialization in Awake/Start, gameplay logic in Update/LateUpdate [Source: docs/game-architecture.md#256]

### Testing
- **Test Location**: Tests should be created in `Assets/_Project/Tests/EditMode/` for unit tests and `Assets/_Project/Tests/PlayMode/` for integration tests [Source: docs/game-architecture.md#708,714]
- **Test Standards**: Follow Unity Test Framework (NUnit-based) standards as specified in the architecture document [Source: docs/game-architecture.md#696-697]
- **Testing Framework**: Use Unity Test Framework for both edit mode and play mode tests [Source: docs/game-architecture.md#703]
- **Test Coverage**: Aim for 80% coverage for game logic components and 50% coverage for UI components [Source: docs/game-architecture.md#700]
- **Specific Testing Requirements**:
  - Unit test PiecePlacement component for valid/invalid move validation
  - Unit test TurnManager for correct turn transitions
  - Integration test click detection accuracy on board intersections
  - Performance test piece placement responsiveness
  - Validate visual feedback for valid placement locations
  - Test turn indicator updates correctly

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-10-12 | v1.0 | Story created based on PRD and architecture document | Bob (Scrum Master) |*